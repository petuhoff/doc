<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_x5n_gv5_qf">
  <title>Формат файлов описания переменных расчетных модулей</title>
  <body>
    
              <p>Каждый из расчётных модулей при генерации кода включает в себя следующие файлы:</p>
              <ul id="ul_av3_41t_qy">
                <li>
                  <p>Исполняемый файл расчётного модуля (образ);</p>
                </li>
                <li>
                  <p>Файл описания внешних переменных расчётного модуля (&lt;имя
                    образа>.extvars.table);</p>
                </li>
                <li>
                  <p>Файл описания внутренних переменных расчётного модуля(&lt;имя
                    образа>.intvars.table);</p>
                </li>
              </ul>
              <p>Исполняемый файл содержит непосредственно исполняемый код, скомпилированный
                компилятором из исходных текстов, сгенерированных генератором кода ПК МВТУ-4. </p>
              <p>Все файлы приборного ПО, включая исполняемые файлы расчётных модулей, диспетчера
                расчётных модулей DispExemod, сервера обмена данными GdbServer и файлов описания
                конфигурации и переменных должны быть размещены в файловой системе прибора в одной
                директории.</p>
              <p>Файл описания внешних переменных содержит таблицу с информацией о типах данных,
                размерностях и именах переменных, которые расчётный модуль должен получить из общей
                для всех РМ в загрузке области памяти (рабочей области памяти внешних переменных).
                Т.е. диспетчер при загрузке РМ прочитывает файлы описания внешних переменных для
                всех РМ и выделяет единую область памяти под все внешние переменные. При этом
                переменные для разных РМ , имеющие одинаковое имя, объединяются (т.е. на них
                выделяется одна и та же область памяти в рабочей памяти). При несовпадении типов –
                выдаётся диагностическое сообщение в консоль и происходит аварийное прекращение
                работы диспетчера. После того как диспетчер выделил общую область памяти для всех
                внешних переменных РМ он сообщает расчётным модулям с каким именно смещением лежат
                нужные переменные для каждого из модулей, данная информация располагается в общей
                области памяти с именем /extvars_struct.</p>
              <p>Файлы описания внутренних переменных такие же по формату, как и файлы описания
                внешних переменных. Они необходимы только для того чтобы сервер отладки мог получить
                по имени нужный адрес для доступа к внутренней переменной конкретного запущенного
                экземпляра расчётного модуля. Области памяти под внутренние переменные выделяются не
                диспетчером, а самим РМ в соответствии с типом конкретной переменной и именем
                алгоритма, указанным при запуске РМ.</p>
              <p>Файлы описания внешних и внутренних переменных представляют собой бинарные файлы и
                состоят из записей типа:</p>
              <p>typedefstruct {</p>
              <p>unsigned char sizeofname;</p>
              <p>char name[64];</p>
              <p>unsigned char sizeofdecsription;</p>
              <p>chardecsription[128];</p>
              <p>unsigned char data_type;</p>
              <p>unsigned long dims[3];</p>
              <p>unsigned char direction;</p>
              <p>unsigned char var_type;</p>
              <p>unsigned long index;</p>
              <p>unsigned short hash;</p>
              <p>} ext_var_info_record;</p>
              <p>Здесь представлены следующие элементы:</p>
              <table id="table_bv3_41t_qy">
                <tgroup cols="2">
                  <colspec colnum="1" colname="col1"/>
                  <colspec colnum="2" colname="col2"/>
                  <tbody>
                    <row>
                      <entry>sizeofname</entry>
                      <entry>– длина имени переменной;</entry>
                    </row>
                    <row>
                      <entry>name</entry>
                      <entry>– массив символов, содержащий имя переменной в кодировке ASCII
                        (допустимая длина – не более 64 символа);</entry>
                    </row>
                    <row>
                      <entry>sizeofdecsription</entry>
                      <entry>– длина текстового описания переменной;</entry>
                    </row>
                    <row>
                      <entry>decsription</entry>
                      <entry>– массив символов, содержащий описание переменной в кодировке ASCII
                        (допустимая длина – не более 128 символа);</entry>
                    </row>
                    <row>
                      <entry>data_type</entry>
                      <entry>
                        <p>– идентификатор типа данных переменной. Допустимые значения:</p>
                        <p>0 – вещественный;</p>
                        <p>1 – двоичный;</p>
                        <p>2 – целый.</p>
                      </entry>
                    </row>
                    <row>
                      <entry>dims</entry>
                      <entry>– массив из трех элементов целого типа, показывающий размерности
                        переменной. Например, если значение dims равно {10,0,0}, то переменная
                        является вектором заданного типа с количеством элементов равным 10;</entry>
                    </row>
                    <row>
                      <entry>direction</entry>
                      <entry>
                        <p>– идентификатор направления переменной. Допустимые значения:</p>
                        <p>0 – вход;</p>
                        <p>1 – выход;</p>
                        <p>2 – выход-выход (т.е. сигнал и читается и пишется в модели).</p>
                      </entry>
                    </row>
                    <row>
                      <entry>var_type</entry>
                      <entry>
                        <p>– идентификатор класса переменной, от которого зависит в каком
                          массиве/области памяти находится переменная. Допустимые значения:</p>
                        <p>0 – <b>Внешняя</b>, это означает, что данная переменная выделяется в
                          памяти диспетчером и делится данным расчётным модулем с другими модулями.
                          К этому классу переменных относятся входы и выходы модели. Отличается тем
                          что в заголовочном файле для этих переменных используется другая адресация
                          (с присваиваемым смещением). Сохраняется в рестарте (то есть, когда
                          пользователь сохранят состояние исполняемой среды на приборе, значения
                          переменных в данной области памяти записываются в файл на диске с именем
                          соответствующим имени сохраняемого состояния). Располагаются в
                          /extvars_value;</p>
                        <p>1 – <b>Динамическая</b> – переменные состояния, которые интегрируются в
                          едином массиве при помощи выбранного метода интегрирования. Данные
                          переменные не расшариваются между отдельными расчётными модулями. Для
                          каждой из таких переменных существуют 2 массива – собственно переменная
                          состояния и её производная. Используются только для интеграторов и
                          динамических блоков. Сохраняется в рестарте. Располагаются в области
                          памяти /din_vars_&lt;имя алгоритма указанное при запуске>;</p>
                        <p>2 – <b>Алгебраическая</b> – переменные состояния, которые содержат
                          значения алгебраических функций и состояний, в данной версии исполняемой
                          среды не используются. Данные переменные не расшариваются между отдельными
                          расчётными модулями. Для каждой из таких переменных существуют 2 массива –
                          собственно переменная состояния и значений алгебраической функции.
                          Используются только для блоков типа Y=F(0) и Y =F(Y). Сохраняется в
                          рестарте. Располагаются в области памяти /alg_vars _&lt;имя алгоритма
                          указанное при запуске>;</p>
                        <p>3 – <b>Внутреннее состояние</b> – выделяются для каждого из загруженных
                          РМ отдельно (т.е. не расшариваются). Предназначены для хранения
                          разнотипных данных (переменных состояния, таймеров, триггеров и т.п.),
                          сохраняется в рестарте. Располагаются в области памяти /state_vars
                          _vars_&lt;имя алгоритма указанное при запуске>;</p>
                        <p>4 – <b>Константа</b> – выделяются для каждого из загруженных РМ отдельно
                          (т.е. не расшариваются). Предназначены для хранения разнотипных данных,
                          которые не меняются в процессе расчёта (но могут быть изменены удалённо
                          пользователем) (постоянных времени, к-тов усиления и т.п.), не сохраняется
                          в рестарте. Располагаются в области памяти /constants _vars_&lt;имя
                          алгоритма указанное при запуске>.</p>
                      </entry>
                    </row>
                    <row>
                      <entry>index</entry>
                      <entry>– байтовое смещение переменной в массиве (какой массив определяется
                        согласно var_type). Для внешних переменных байтовое смещение определяется
                        диспетчером при загрузке РМ, и затем передаётся в область памяти
                        /extvars_struct, в файле описания внешних переменных на диске
                        (*.extvars.table) в качестве индекса передаётся номер внешней переменной в
                        массиве указателей внутри расчётного модуля;</entry>
                    </row>
                    <row>
                      <entry>hash</entry>
                      <entry>– хэш имени переменной вычисленный по алгоритму CRC16.</entry>
                    </row>
                  </tbody>
                </tgroup>
              </table>
  </body>
</topic>
