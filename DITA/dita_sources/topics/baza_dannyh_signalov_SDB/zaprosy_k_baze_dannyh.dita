<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_x5n_gv5_qf">
  <title>Запросы к базе данных сигналов SDB</title>
  <body>
<p>Интерпретатор встроенного языка программирования поддерживает запросы к базе
                данных, в результате интерпретации и обработки которых база данных сигналов SDB
                возвращает ту или иную информацию. Общая структура и формат
                  запроса:</p>
    <codeblock>{<b>query</b>:
category = "фильтр_имени_категории";
group = "фильтр_имени_группы_сигналов";
name = "фильтр_имени_сигнала";<b>
&lt;what</b> = "запрос"<b>></b> };</codeblock><p>где
                  <b>query</b> – служебное слово, обозначающее запрос к базе
                  данных,</p><p>&lt;<b>wha</b><b>t</b> = "запрос"> – опциональное дополнение к
                запросу, указывающее на тип информации, которую следует извлечь из базы данных. В
                качестве "запроса" допустимо указать один из 5 типов информации: count, group,
                groupnumber, caption, value.</p><p>Если запрос не указан, то по умолчанию
                возвращаемая информация — имена сигналов.</p><p>Если запрашиваемая информация —
                строковая, то запрос следует окружать кавычками (см. пример ниже). Если численная,
                то кавычки не нужны.</p><p>1) Запрос количества сигналов в базе данных:</p><p>Формат
                запроса:</p><p>number_of_signals = {<b>query</b>:</p><p>category =
                "фильтр_имени_категории";</p><p>group = "фильтр_имени_группы_сигналов";</p><p>name =
                "фильтр_имени_сигнала";</p><p><b>what</b> = count };</p><p>Тип возвращаемого
                значения — <b>целое число</b> (integer). Фильтром имени категории может выступать
                как имя требуемой категории, так и маска с использованием символа * (звёздочки).
                Аналогичным образом задаются фильтр имени группы сигналов и фильтр имени
                сигнала.</p><p>2) Запрос имён групп сигналов, к которым принадлежат сигналы.</p><p>Формат
                запроса:</p><p>names_of_groups = "{ query:</p><p>category =
                "фильтр_имени_категории";</p><p>group = "фильтр_имени_группы_сигналов";</p><p>name =
                "фильтр_имени_сигнала";</p><p>what = group }" ;</p><p>Тип возвращаемого значения —
                  <b>строка</b> (string). В возвращенной строке содержится ноль символов, если
                группа сигналов в базе данных не найдена, имя одной группы сигналов если найдена
                одна группа, и несколько имен групп сигналов, если найдено несколько групп сигналов.
                Имена групп сигналов в строке разделяются служебным символом ; (<b>точкой с
                  запятой</b><b>)</b>. Фильтром имени категории может выступать как имя требуемой
                категории, так и маска с использованием символа * (звёздочки). Аналогичным образом
                задается фильтр имени группы сигналов и фильтр имени сигнала.</p><p>3) Запрос номеров
              групп сигналов, к которым принадлежат сигналы.</p><p>Формат
                запроса:</p><p>numbers_of_groups = "{ query:</p><p>category =
                "фильтр_имени_категории";</p><p>group = "фильтр_имени_группы_сигналов";</p><p>name =
                "фильтр_имени_сигнала";</p><p>what = groupnumber }" ;</p><p>Тип возвращаемого
                значения — <b>строка</b> (string). В возвращенной строке содержится ноль символов,
                если группа сигналов в базе данных не найдена, номер одной группы сигналов если
                найдена одна группа, и несколько номеров групп сигналов, если найдено несколько
                групп сигналов. Номера групп сигналов в строке разделяются служебным символом ;
                  (<b>точкой с запятой</b><b>)</b>. Фильтром имени категории может выступать как имя
                требуемой категории, так и маска с использованием символа * (звёздочки). Аналогичным
                образом задается фильтр имени группы сигналов и фильтр имени сигнала.</p><p>4) Запрос
              имен сигналов, содержащихся в базе данных.</p><p>Если не использовано служебное слово
                  <b>what</b>, то по умолчанию возвращаемая строка содержит имена сигналов,
                удовлетворяющих заданному фильтру. Формат запроса:</p><p>names_of_signals = "{
                query:</p><p>category = "фильтр_имени_категории";</p><p>group =
                "фильтр_имени_группы_сигналов";</p><p>name = "фильтр_имени_сигнала" }" ;</p><p>Тип
                возвращаемого значения — <b>строка</b> (string). В возвращенной строке содержится
                ноль символов, если сигналов в базе данных не найдено, имя одного сигнала если
                найден 1 сигнал, и имена нескольких сигналов, если найдено несколько сигналов. Имена
                сигналов в строке разделяются служебным символом ; (<b>точкой с запятой</b><b>)</b>.
                Фильтром имени категории может выступать как имя требуемой категории, так и маска с
                использованием символа * (звёздочки). Аналогичным образом задается фильтр имени
                группы сигналов и фильтр имени сигнала.</p><p>5) Запрос названий сигналов.</p><p>Формат
                запроса:</p><p>titles_of_signals = "{ query:</p><p>category =
                "фильтр_имени_категории";</p><p>group = "фильтр_имени_группы_сигналов";</p><p>name =
                "фильтр_имени_сигнала";</p><p>what = caption }" ;</p><p>Тип возвращаемого значения —
                  <b>строка</b> (string). В возвращенной строке содержится ноль символов, если
                сигналов в базе данных не найдено, название одного сигнала если найден 1 сигнал, и
                названия нескольких сигналов, если найдено несколько сигналов. Названия сигналов в
                строке разделяются служебным символом ; (<b>точкой с запятой</b><b>)</b>. Фильтром
                имени категории может выступать как имя требуемой категории, так и маска с
                использованием символа * (звёздочки). Аналогичным образом задается фильтр имени
                группы сигналов и фильтр имени сигнала.</p><p>6) Запрос значений сигналов.</p><p>Формат
                запроса:</p><p>values_of_signals = "{ query:</p><p>category =
                "фильтр_имени_категории";</p><p>group = "фильтр_имени_группы_сигналов";</p><p>name =
                "фильтр_имени_сигнала";</p><p>what = value }" ;</p><p>Тип возвращаемого значения —
                  <b>строка</b> (string). В возвращенной строке содержится ноль символов, если
                сигналов в базе данных не найдено, значение одного сигнала если найден 1 сигнал, и
                значения нескольких сигналов, если найдено несколько сигналов. Значения сигналов в
                строке разделяются служебным символом ; (<b>точкой с запятой</b><b>)</b>. Фильтром
                имени категории может выступать как имя требуемой категории, так и маска с
                использованием символа * (звёздочки). Аналогичным образом задается фильтр имени
                группы сигналов и фильтр имени сигнала.</p><p>7) Запрос с применением множественного
                фильтра.</p><p>Для задания множественного фильтра надо его задавать так: group =
                "строка_1","строка_2". Разделитель фильтров — запятая. При этом в самих фильтрах
                допустим символ звёздочки, например: group="LBB*CP*","LBB*CT*";</p><p>Формат
                запроса:</p><p>number_of_signals = { query:</p><p>category =
                "фильтр_имени_категории";</p><p>group = "фильтр1","фильтр2","фильтр3";</p><p>name =
                "фильтр_имени_сигнала";</p><p>what = count };</p><p>Тип возвращаемого значения в
                данном запросе — <b>целое число</b> (integer). Но в зависимости от запроса тип будет
                соответствующим.</p><p>Пример экспорта информации из базы данных в текстовый файл,
                путем использования языка программирования
                SimInTech:</p><p><b>initialization</b></p><p>
                <b>formattext</b></p><p> // количество сигналов в БД</p><p> number_of_signals = {
                query: category = "Датчики"; group = "*"; name = "*"; what = count}; </p><p> // имя
                группы, к которой принадлежит сигнал</p><p> names_of_groups = "{ query: category =
                "Датчики"; group = "*"; name = "*"; what = group}";</p><p> // номер группы, к
                которой принадлежит сигнал</p><p> numbers_of_groups = "{ query: category =
                "Датчики"; group = "*"; name = "*"; what = groupnumber}"; </p><p> // по умолчанию
                выводятся имена сигналов в БД !!!</p><p> names_of_signals = "{ query: category =
                "Датчики"; group = "*"; name = "*";}" ; </p><p> // названия сигналов в БД</p><p>
                titles_of_signals = "{ query: category = "Датчики"; group = "*"; name = "*"; what =
                caption}" ; </p><p> // значение сигнала</p><p> values_of_signals = "{ query:
                category = "Датчики"; group = "*"; name = "*"; what = value}" ; </p><p>
                <b>end</b>; </p><p> FileID = <b>createfile</b>("signals.out.txt",1); // открываем
                существующий!!! файл на запись </p><p>
                <b>writeln</b>(FileID, number_of_signals );</p><p>
                <b>writeln</b>(FileID, names_of_groups );</p><p>
                <b>writeln</b>(FileID, names_of_signals );</p><p>
                <b>writeln</b>(FileID, titles_of_signals );</p><p>
                <b>writeln</b>(FileID, values_of_signals ); </p><p>
                <b>freeobject</b>(FileID); // закрываем файл </p><p><b>end</b>;</p>
  </body>
</topic>
